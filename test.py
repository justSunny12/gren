# test_minimal.py - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –±–µ–∑ –º–æ–¥–µ–ª–∏
import gradio as gr
import time
import random

# –ó–∞–≥–ª—É—à–∫–∞ –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏
class MockModel:
    def __init__(self):
        self.responses = [
            "–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –æ—Ç –º–æ–¥–µ–ª–∏.",
            "–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–µ—Å—Ç–æ–≤—ã–π —á–∞—Ç-–±–æ—Ç.",
            "–ö–∞–∫ —É –≤–∞—Å –¥–µ–ª–∞?",
            "–Ø –º–æ–≥—É –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ.",
            "–ú–æ–¥–µ–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–∞–±–æ—Ç–∞–µ—Ç!",
            "–≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —á–∞—Ç-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞."
        ]
    
    def generate(self, message):
        # –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ –æ—Ç–≤–µ—Ç–∞
        time.sleep(0.5)
        # –°–ª—É—á–∞–π–Ω—ã–π –æ—Ç–≤–µ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞
        return random.choice(self.responses)

# –°–æ–∑–¥–∞–µ–º –∑–∞–≥–ª—É—à–∫—É –º–æ–¥–µ–ª–∏
mock_model = MockModel()

# –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ (–ø—Ä–æ—Å—Ç–æ —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π)
chat_history = []

def send_message(message, history):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è"""
    if not message.strip():
        return "", history
    
    # –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∏—Å—Ç–æ—Ä–∏—é
    history.append([message, None])
    
    # –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç –∑–∞–≥–ª—É—à–∫–∏ –º–æ–¥–µ–ª–∏
    response = mock_model.generate(message)
    
    # –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é
    history[-1][1] = response
    
    return "", history

def clear_chat():
    """–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç"""
    return []

# –°–æ–∑–¥–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
with gr.Blocks(title="–¢–µ—Å—Ç–æ–≤—ã–π —á–∞—Ç (–±–µ–∑ –º–æ–¥–µ–ª–∏)") as demo:
    gr.Markdown("# üß™ –¢–µ—Å—Ç–æ–≤—ã–π —á–∞—Ç-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å")
    gr.Markdown("–ú–æ–¥–µ–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–∞–≥–ª—É—à–∫–∞")
    
    # –ß–∞—Ç
    chatbot = gr.Chatbot(label="–ß–∞—Ç", height=500)
    
    # –ü–æ–ª–µ –≤–≤–æ–¥–∞ –∏ –∫–Ω–æ–ø–∫–∏
    with gr.Row():
        msg = gr.Textbox(
            placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...",
            show_label=False,
            scale=8,
            container=False
        )
        submit_btn = gr.Button("–û—Ç–ø—Ä–∞–≤–∏—Ç—å", variant="primary", scale=1)
        clear_btn = gr.Button("–û—á–∏—Å—Ç–∏—Ç—å", variant="secondary", scale=1)
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    msg.submit(send_message, [msg, chatbot], [msg, chatbot])
    submit_btn.click(send_message, [msg, chatbot], [msg, chatbot])
    clear_btn.click(clear_chat, None, [chatbot])
    
    # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    gr.Markdown("---")
    gr.Markdown("### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:")
    gr.Markdown("- –ú–æ–¥–µ–ª—å: –ó–∞–≥–ª—É—à–∫–∞ (–Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞)")
    gr.Markdown("- –†–µ–∂–∏–º: –¢–µ—Å—Ç–æ–≤—ã–π")
    gr.Markdown("- –û—Ç–≤–µ—Ç—ã: –†–∞–Ω–¥–æ–º–Ω—ã–µ –∏–∑ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞")

# –ó–∞–ø—É—Å–∫
if __name__ == "__main__":
    print("üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...")
    print("üìå –°—Å—ã–ª–∫–∞: http://localhost:7860")
    print("‚ö†Ô∏è  –ú–æ–¥–µ–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–∞–≥–ª—É—à–∫–∞")
    demo.launch(server_port=7860, share=False)